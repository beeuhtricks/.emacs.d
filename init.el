;;; init.el --- Beatrix Klebe's Emacs init file -*- lexical-binding: t; -*-

;;; Commentary:
;;; This config borrows liberally from bbatsov's Emacs Prelude (https://github.com/bbatsov/prelude).

;;; Code:

(require 'cl)
(require 'package)

(setq gc-cons-threshold 402653184
      gc-cons-percentage 0.6)

(setq gnutls-algorithm-priority "NORMAL:-VERS-TLS1.3")

(defvar file-name-handler-alist-cache file-name-handler-alist)
(setq file-name-handler-alist nil)

(defvar root-dir (file-name-directory load-file-name)
  "The root of the current Emacs configuration.")

(defvar lisp-dir (expand-file-name "lisp" root-dir)
  "Location of my custom Lisp modules.")

(defvar autogen-dir (expand-file-name "autogen" lisp-dir)
  "Location for all automatically generated Lisp files.")

(defvar custom-storage-file (expand-file-name "custom.el" autogen-dir)
  "Where autogenerated custom.el settings go.")

(setq custom-file custom-storage-file)

(add-to-list 'load-path lisp-dir)

;; Cribs liberally from bbatsov/prelude/core/prelude-packages.el

(add-to-list 'package-archives '("melpa" . "https://melpa.org/packages/") t)

(package-initialize)

(defvar bootstrap-packages
  '(use-package
    delight))

(defun bootstrap-packages-installed-p ()
  "Check if all packages in 'bootstrap-packages' are installed."
  (every #'package-installed-p bootstrap-packages))

(defun install-package (package)
  (unless (package-installed-p package)
    (package-install package)))

(defun install-packages (packages)
  (mapc #'install-package packages))

(defun install-bootstrap-packages ()
  "Install all packages required to bootstrap our setup."
  (unless (bootstrap-packages-installed-p)
    (package-refresh-contents)
    (install-packages bootstrap-packages)))

(install-bootstrap-packages)

(eval-when-compile (require 'use-package))
(require 'bind-key)

(setq use-package-always-ensure t)
(setq use-package-always-defer t)

(use-package delight)

(use-package auto-package-update :demand
  :config
  (setq auto-package-update-delete-old-versions t)
  (setq auto-package-update-hide-results t)
  (auto-package-update-maybe))

(require 'ui)
(require 'backup)
(when (eq system-type 'darwin) (require 'macos-config))
(when (eq system-type 'windows-nt) (require 'windows-config))

(require 'company-config)
(require 'flycheck-config)
(require 'editor)

(require 'development)

(require 'org-mode-config)

(setq gc-cons-threshold 16777216
      gc-cons-percentage 0.1)

(setq file-name-handler-alist file-name-handler-alist-cache)

(provide 'init)
;;; init.el ends here
